jobs:
  terraform_destroy:
    # ... (runs-on, if: condition) ...
    
    env:
      AWS_REGION: us-east-1
      BUCKET_NAME: my-unique-jishnu-hardik-managed-bucket-2025 # Your bucket name
      
    steps:
      # ... (Checkout, Configure AWS Credentials, Setup Terraform steps) ...

      # --- 1. Initialize Terraform (Load state from S3 backend) ---
      - name: Initialize Terraform (Load state from S3 backend)
        run: |
          # Uses the BUCKET_NAME env variable for the backend configuration
          terraform init \
            -backend-config="bucket=${{ env.BUCKET_NAME }}" \
            -backend-config="region=${{ env.AWS_REGION }}"
            
      # --- 2. Empty the S3 Bucket (CRITICAL: Removes the state file) ---
      - name: Empty S3 Bucket contents using AWS CLI üóëÔ∏è
        id: empty_bucket
        # Uses the BUCKET_NAME env variable in the AWS CLI command
        run: |
          echo "Emptying bucket: ${{ env.BUCKET_NAME }}"
          aws s3 rm s3://${{ env.BUCKET_NAME }} --recursive
          
      # --- 3. Run Terraform Destroy (Destroys all resources including the now-empty bucket) ---
      - name: Run Terraform Destroy üî•
        run: terraform destroy -auto-approve
        
      # --- 4. Final Cleanup (Ensures the empty bucket is terminated, if Terraform failed to delete it) ---
      - name: Force delete the S3 Bucket using AWS CLI üí£
        # This step is a safeguard to explicitly remove the empty bucket.
        run: aws s3 rb s3://${{ env.BUCKET_NAME }} --force
